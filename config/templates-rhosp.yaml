---

- template:
    name: rhosp13-os-not-implemented-targets
    streams:
      rhosp13-os-not-implemented-targets:
        vars:
          MONITORING_DEPLOY_TARGET: ISSU,CCImport
          MONITORING_DEPLOYER: rhosp13
          MONITORING_ORCHESTRATOR: os

- template:
    name: rhosp16-os-not-implemented-targets
    streams:
      rhosp16-os-not-implemented-targets:
        vars:
          MONITORING_DEPLOY_TARGET: PROD,ISSU,SR-IOV,DPDK,CCImport
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os

- template:
    name: rhosp13-1912
    # to use latest deployer's code
    parents:
      - build-ubi-deployers
    streams:
      rhosp13-1912:
        vars:
          ENVIRONMENT_OS: rhel7
          TAG_SUFFIX: "-ubi7"
          DEPLOY_COMPACT_AIO: true
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          CONTRAIL_CONTAINER_TAG: 'nightly-r1912'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
    jobs:
      deploy-platform-rhosp13-1912:
        stream: rhosp13-1912
        job-name: deploy-platform-rhosp13
      deploy-tf-rhosp13-1912:
        stream: rhosp13-1912
        job-name: deploy-tf-rhosp13
        depends-on:
          # to use latest deployer's code
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp13-1912
      test-sanity-rhosp13-1912:
        job-name: test-sanity
        stream: rhosp13-1912
        depends-on:
          - deploy-tf-rhosp13-1912
      collect-logs-and-cleanup-rhosp13-1912:
        job-name: collect-logs-and-cleanup
        stream: rhosp13-1912
        type: post-hook
        depends-on:
          - deploy-platform-rhosp13-1912
          - deploy-tf-rhosp13-1912
          - test-sanity-rhosp13-1912

- template:
    name: rhosp13-2011
    # to use latest deployer's code
    parents:
      - build-ubi-deployers
    streams:
      rhosp13-2011:
        vars:
          ENVIRONMENT_OS: rhel7
          TAG_SUFFIX: "-ubi7"
          DEPLOY_COMPACT_AIO: true
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          CONTRAIL_CONTAINER_TAG: 'nightly-r2011'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
          MONITORING_DEPLOY_TARGET: ILTS,AIO
          MONITORING_DEPLOYER: rhosp13
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp13-2011:
        stream: rhosp13-2011
        job-name: deploy-platform-rhosp13
      deploy-tf-rhosp13-2011:
        stream: rhosp13-2011
        job-name: deploy-tf-rhosp13
        depends-on:
          # to use latest deployer's code
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp13-2011
      test-sanity-rhosp13-2011:
        job-name: test-sanity
        stream: rhosp13-2011
        depends-on:
          - deploy-tf-rhosp13-2011
      collect-logs-and-cleanup-rhosp13-2011:
        job-name: collect-logs-and-cleanup
        stream: rhosp13-2011
        type: post-hook
        depends-on:
          - deploy-platform-rhosp13-2011
          - deploy-tf-rhosp13-2011
          - test-sanity-rhosp13-2011

- template:
    name: rhosp16.2
    # to use latest deployer's code
    parents:
      - build-ubi8
    streams:
      rhosp16.2:
        vars:
          ENVIRONMENT_OS: rhel84
          TAG_SUFFIX: "-ubi8"
          DEPLOY_COMPACT_AIO: true
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
    jobs:
      deploy-platform-rhosp16.2:
        stream: rhosp16.2
        job-name: deploy-platform-rhosp16
      deploy-tf-rhosp16.2:
        stream: rhosp16.2
        job-name: deploy-tf-rhosp16
        depends-on:
          - package-ubi8
          - deploy-platform-rhosp16.2
      test-sanity-rhosp16.2:
        job-name: test-sanity
        stream: rhosp16.2
        depends-on:
          - deploy-tf-rhosp16.2
      collect-logs-and-cleanup-rhosp16.2:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.2
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.2
          - deploy-tf-rhosp16.2
          - test-sanity-rhosp16.2

- template:
    name: rhosp16.2-ha
    # to use latest deployer's code
    parents:
      - build-ubi8
    streams:
      rhosp16.2-ha:
        vars:
          ENVIRONMENT_OS: rhel84
          TAG_SUFFIX: "-ubi8"
          SSL_ENABLE: true
          DEPLOY_COMPACT_AIO: true
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:3,AGENT_NODES:small:1'
    jobs:
      deploy-platform-rhosp16.2-ha:
        stream: rhosp16.2-ha
        job-name: deploy-platform-rhosp16
      deploy-tf-rhosp16.2-ha:
        stream: rhosp16.2-ha
        job-name: deploy-tf-rhosp16
        depends-on:
          - package-ubi8
          - deploy-platform-rhosp16.2-ha
      test-sanity-rhosp16.2-ha:
        job-name: test-sanity
        stream: rhosp16.2-ha
        depends-on:
          - deploy-tf-rhosp16.2-ha
      collect-logs-and-cleanup-rhosp16.2-ha:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.2-ha
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.2-ha
          - deploy-tf-rhosp16.2-ha
          - test-sanity-rhosp16.2-ha

- template:
    name: rhosp16.1-2011
    # to use latest deployer's code
    parents:
      - build-ubi-deployers
    streams:
      rhosp16.1-2011:
        vars:
          ENVIRONMENT_OS: rhel82
          TAG_SUFFIX: "-ubi7"
          DEPLOY_COMPACT_AIO: true
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          CONTRAIL_CONTAINER_TAG: 'nightly-r2011'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
          MONITORING_DEPLOY_TARGET: ILTS,AIO
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp16.1-2011:
        stream: rhosp16.1-2011
        job-name: deploy-platform-rhosp16
      deploy-tf-rhosp16.1-2011:
        stream: rhosp16.1-2011
        job-name: deploy-tf-rhosp16
        depends-on:
          # to use latest deployer's code
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp16.1-2011
      test-sanity-rhosp16.1-2011:
        job-name: test-sanity
        stream: rhosp16.1-2011
        depends-on:
          - deploy-tf-rhosp16.1-2011
      collect-logs-and-cleanup-rhosp16.1-2011:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.1-2011
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.1-2011
          - deploy-tf-rhosp16.1-2011
          - test-sanity-rhosp16.1-2011

- template:
    name: rhosp16.1-ha
    parents:
      - build-ubi-deployers
    streams:
      rhosp16.1-ha:
        vars:
          ENVIRONMENT_OS: rhel82
          TAG_SUFFIX: "-ubi7"
          SSL_ENABLE: true
          ENABLE_RHEL_REGISTRATION: false
          CONTRAIL_CONTAINER_TAG: 'nightly-r2011'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:3,AGENT_NODES:small:1'
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          MONITORING_DEPLOY_TARGET: HA
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp16.1-ha:
        job-name: deploy-platform-rhosp16
        stream: rhosp16.1-ha
      deploy-tf-rhosp16.1-ha:
        job-name: deploy-tf-rhosp16
        stream: rhosp16.1-ha
        depends-on:
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp16.1-ha
      test-sanity-rhosp16.1-ha:
        job-name: test-sanity
        stream: rhosp16.1-ha
        depends-on:
          - deploy-tf-rhosp16.1-ha
      collect-logs-and-cleanup-rhosp16.1-ha:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.1-ha
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.1-ha
          - deploy-tf-rhosp16.1-ha
          - test-sanity-rhosp16.1-ha

- template:
    name: rhosp13-bmc
    parents:
      - build-ubi-deployers
    streams:
      rhosp13-bmc:
        lock: openlab1
        vars:
          JUMPHOST: openlab1
          ENVIRONMENT_OS: rhel7
          TAG_SUFFIX: "-ubi7"
          SSL_ENABLE: true
          ENABLE_RHEL_REGISTRATION: false
          ENABLE_NETWORK_ISOLATION: true
          OPENSTACK_CONTAINER_REGISTRY: "10.10.50.2:5000"
          CONTRAIL_CONTAINER_TAG: 'nightly-r2011'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
          MONITORING_DEPLOY_TARGET: PROD,SR-IOV,DPDK
          MONITORING_DEPLOYER: rhosp13
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp13-bmc:
        job-name: deploy-platform-rhosp13
        stream: rhosp13-bmc
      deploy-tf-rhosp13-bmc:
        job-name: deploy-tf-rhosp13
        stream: rhosp13-bmc
        timeout: 240
        depends-on:
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp13-bmc
      test-sanity-rhosp13-bmc:
        job-name: test-sanity
        stream: rhosp13-bmc
        depends-on:
          - deploy-tf-rhosp13-bmc
      collect-logs-and-cleanup-rhosp13-bmc:
        job-name: collect-logs-and-cleanup
        stream: rhosp13-bmc
        type: post-hook
        depends-on:
          - deploy-platform-rhosp13-bmc
          - deploy-tf-rhosp13-bmc
          - test-sanity-rhosp13-bmc

- template:
    name: rhosp16.1-bmc
    parents:
      - build-ubi-deployers
    streams:
      rhosp16.1-bmc:
        lock: openlab1
        vars:
          JUMPHOST: openlab1
          ENVIRONMENT_OS: rhel82
          TAG_SUFFIX: "-ubi8"
          SSL_ENABLE: true
          ENABLE_RHEL_REGISTRATION: false
          ENABLE_NETWORK_ISOLATION: true
          OPENSTACK_CONTAINER_REGISTRY: "mirrors:5005"
          CONTRAIL_CONTAINER_TAG: 'nightly'
          CONTAINER_REGISTRY: "tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5102"
          MONITORING_DEPLOY_TARGET: PROD,SR-IOV,DPDK
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp16.1-bmc:
        job-name: deploy-platform-rhosp16
        stream: rhosp16.1-bmc
      deploy-tf-rhosp16.1-bmc:
        job-name: deploy-tf-rhosp16
        stream: rhosp16.1-bmc
        timeout: 240
        depends-on:
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp16.1-bmc
      test-sanity-rhosp16.1-bmc:
        job-name: test-sanity
        stream: rhosp16.1-bmc
        depends-on:
          - deploy-tf-rhosp16.1-bmc
      collect-logs-and-cleanup-rhosp16.1-bmc:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.1-bmc
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.1-bmc
          - deploy-tf-rhosp16.1-bmc
          - test-sanity-rhosp16.1-bmc

- template:
    name: rhosp16.2-bmc
    parents:
      - build-ubi8
    streams:
      rhosp16.2-bmc:
        lock: openlab1
        vars:
          JUMPHOST: openlab1
          ENVIRONMENT_OS: rhel84
          TAG_SUFFIX: "-ubi8"
          SSL_ENABLE: true
          ENABLE_RHEL_REGISTRATION: false
          ENABLE_NETWORK_ISOLATION: true
          OPENSTACK_CONTAINER_REGISTRY: "mirrors:5005"
          MONITORING_DEPLOY_TARGET: PROD,SR-IOV,DPDK
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp16.2-bmc:
        job-name: deploy-platform-rhosp16
        stream: rhosp16.2-bmc
      deploy-tf-rhosp16.2-bmc:
        job-name: deploy-tf-rhosp16
        stream: rhosp16.2-bmc
        timeout: 240
        depends-on:
          - package-ubi8
          - deploy-platform-rhosp16.2-bmc
      test-sanity-rhosp16.2-bmc:
        job-name: test-sanity
        stream: rhosp16.2-bmc
        depends-on:
          - deploy-tf-rhosp16.2-bmc
      collect-logs-and-cleanup-rhosp16.2-bmc:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.2-bmc
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.2-bmc
          - deploy-tf-rhosp16.2-bmc
          - test-sanity-rhosp16.2-bmc

- template:
    name: rhosp16.2-bmc-2011
    parents:
      - build-ubi
    streams:
      rhosp16.2-bmc-2011:
        lock: openlab1
        vars:
          JUMPHOST: openlab1
          ENVIRONMENT_OS: rhel84
          TAG_SUFFIX: "-ubi7"
          SSL_ENABLE: true
          ENABLE_RHEL_REGISTRATION: false
          ENABLE_NETWORK_ISOLATION: true
          OPENSTACK_CONTAINER_REGISTRY: "mirrors:5005"
          MONITORING_DEPLOY_TARGET: PROD,SR-IOV,DPDK
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp16.2-bmc-2011:
        job-name: deploy-platform-rhosp16
        stream: rhosp16.2-bmc-2011
      deploy-tf-rhosp16.2-bmc-2011:
        job-name: deploy-tf-rhosp16
        stream: rhosp16.2-bmc-2011
        timeout: 240
        depends-on:
          - package-ubi
          - deploy-platform-rhosp16.2-bmc-2011
      test-sanity-rhosp16.2-bmc-2011:
        job-name: test-sanity
        stream: rhosp16.2-bmc-2011
        depends-on:
          - deploy-tf-rhosp16.2-bmc-2011
      collect-logs-and-cleanup-rhosp16.2-bmc-2011:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.2-bmc-2011
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.2-bmc-2011
          - deploy-tf-rhosp16.2-bmc-2011
          - test-sanity-rhosp16.2-bmc-2011

- template:
    name: rhosp16.1-slave01
    parents:
      - build-ubi-deployers
    streams:
      rhosp16.1-slave01:
        lock: openlab3
        vars:
          DEBUG: true
          JUMPHOST: openlab3
          ENVIRONMENT_OS: rhel82
          TAG_SUFFIX: "-ubi7"
          ENABLE_RHEL_REGISTRATION: true
          CONTRAIL_CONTAINER_TAG: 'nightly-r2011'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
          ENABLE_NETWORK_ISOLATION: false
          HUGEPAGES_ENABLED: false
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:1,AGENT_NODES:small:1'
    jobs:
      deploy-platform-rhosp16.1-slave01:
        job-name: deploy-platform-rhosp16
        stream: rhosp16.1-slave01
      deploy-tf-rhosp16.1-slave01:
        job-name: deploy-tf-rhosp16
        stream: rhosp16.1-slave01
        timeout: 240
        depends-on:
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp16.1-slave01
      test-sanity-rhosp16.1-slave01:
        job-name: test-sanity
        stream: rhosp16.1-slave01
        depends-on:
          - deploy-tf-rhosp16.1-slave01
      collect-logs-and-cleanup-rhosp16.1-slave01:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.1-slave01
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.1-slave01
          - deploy-tf-rhosp16.1-slave01
          - test-sanity-rhosp16.1-slave01

- template:
    name: rhosp16.2-slave04
    parents:
      - build-ubi-deployers
    streams:
      rhosp16.2-slave04:
        lock: openlab4
        vars:
          DEBUG: true
          JUMPHOST: openlab4
          ENVIRONMENT_OS: rhel84
          TAG_SUFFIX: "-ubi8"
          ENABLE_RHEL_REGISTRATION: true
          CONTRAIL_CONTAINER_TAG: 'nightly'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5102'
          ENABLE_NETWORK_ISOLATION: false
          HUGEPAGES_ENABLED: false
          SSL_ENABLE: true
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:1,AGENT_NODES:small:1'
    jobs:
      deploy-platform-rhosp16.2-slave04:
        job-name: deploy-platform-rhosp16
        stream: rhosp16.2-slave04
      deploy-tf-rhosp16.2-slave04:
        job-name: deploy-tf-rhosp16
        stream: rhosp16.2-slave04
        timeout: 240
        depends-on:
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp16.2-slave04
      test-sanity-rhosp16.2-slave04:
        job-name: test-sanity
        stream: rhosp16.2-slave04
        depends-on:
          - deploy-tf-rhosp16.2-slave04
      collect-logs-and-cleanup-rhosp16.2-slave04:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.2-slave04
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.2-slave04
          - deploy-tf-rhosp16.2-slave04
          - test-sanity-rhosp16.2-slave04

- template:
    name: rhosp13-ha
    parents:
      - build-ubi-deployers
    streams:
      rhosp13-ha:
        vars:
          ENVIRONMENT_OS: rhel7
          TAG_SUFFIX: "-ubi7"
          SSL_ENABLE: true
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          CONTRAIL_CONTAINER_TAG: 'nightly-r2011'
          CONTAINER_REGISTRY: 'tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002'
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:3,AGENT_NODES:small:1'
          MONITORING_DEPLOY_TARGET: HA
          MONITORING_DEPLOYER: rhosp13
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp13-ha:
        stream: rhosp13-ha
        job-name: deploy-platform-rhosp13
      deploy-tf-rhosp13-ha:
        stream: rhosp13-ha
        job-name: deploy-tf-rhosp13
        depends-on:
          - package-deployers-ubi-deployers
          - deploy-platform-rhosp13-ha
      test-sanity-rhosp13-ha:
        job-name: test-sanity
        stream: rhosp13-ha
        depends-on:
          - deploy-tf-rhosp13-ha
      collect-logs-and-cleanup-rhosp13-ha:
        job-name: collect-logs-and-cleanup
        stream: rhosp13-ha
        type: post-hook
        depends-on:
          - deploy-platform-rhosp13-ha
          - deploy-tf-rhosp13-ha
          - test-sanity-rhosp13-ha

- template:
    name: rhosp13-ha-ziu
    parents:
      - build-ubi8
    streams:
      rhosp13-ha-ziu:
        vars:
          ENVIRONMENT_OS: rhel7
          SSL_ENABLE: true
          CONTAINER_REGISTRY: tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002
          CONTRAIL_CONTAINER_TAG: nightly-r2011
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:3,AGENT_NODES:small:1'
          MONITORING_DEPLOY_TARGET: HA,ZIU
          MONITORING_DEPLOYER: rhosp13
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp13-ha-ziu:
        stream: rhosp13-ha-ziu
        job-name: deploy-platform-rhosp13
        vars:
          TAG_SUFFIX: "-ubi7"
      deploy-tf-rhosp13-ha-ziu:
        stream: rhosp13-ha-ziu
        job-name: deploy-tf-rhosp13
        vars:
          TAG_SUFFIX: "-ubi7"
        depends-on:
          - deploy-platform-rhosp13-ha-ziu
      test-deployment-rhosp13-ha-ziu:
        stream: rhosp13-ha-ziu
        job-name: test-deployment
        vars:
          DEPLOYMENT_TEST_TAGS: ziu
          TF_DEPLOYMENT_TEST_IMAGE: $CONTAINER_REGISTRY_ORIGINAL/tf-deployment-test:$CONTRAIL_CONTAINER_TAG_ORIGINAL$TAG_SUFFIX
          TAG_SUFFIX: "-ubi8"
        depends-on:
          - package-ubi8
          - deploy-tf-rhosp13-ha-ziu
      test-sanity-rhosp13-ha-ziu:
        job-name: test-sanity
        stream: rhosp13-ha-ziu
        vars:
          TF_TEST_IMAGE: $CONTAINER_REGISTRY_ORIGINAL/contrail-test-test:$CONTRAIL_CONTAINER_TAG_ORIGINAL$TAG_SUFFIX
          TAG_SUFFIX: "-ubi8"
        depends-on:
          - test-deployment-rhosp13-ha-ziu
      collect-logs-and-cleanup-rhosp13-ha-ziu:
        job-name: collect-logs-and-cleanup
        stream: rhosp13-ha-ziu
        type: post-hook
        depends-on:
          - deploy-platform-rhosp13-ha-ziu
          - deploy-tf-rhosp13-ha-ziu
          - test-deployment-rhosp13-ha-ziu
          - test-sanity-rhosp13-ha-ziu

- template:
    name: rhosp16.1-ha-ziu
    parents:
      - build-ubi8
    streams:
      rhosp16.1-ha-ziu:
        vars:
          ENVIRONMENT_OS: rhel82
          SSL_ENABLE: true
          CONTAINER_REGISTRY: tf-nexus.$SLAVE_REGION.$CI_DOMAIN:5002
          CONTRAIL_CONTAINER_TAG: nightly-r2011
          ENABLE_RHEL_REGISTRATION: false
          OPENSTACK_CONTAINER_REGISTRY: "tf-mirrors.$SLAVE_REGION.$CI_DOMAIN:5005"
          NODES: 'OPENSTACK_CONTROLLER_NODES:medium:1,CONTROLLER_NODES:medium:3,AGENT_NODES:small:1'
          MONITORING_DEPLOY_TARGET: HA,ZIU
          MONITORING_DEPLOYER: rhosp16
          MONITORING_ORCHESTRATOR: os
    jobs:
      deploy-platform-rhosp16.1-ha-ziu:
        stream: rhosp16.1-ha-ziu
        job-name: deploy-platform-rhosp16
        vars:
          TAG_SUFFIX: "-ubi7"
      deploy-tf-rhosp16.1-ha-ziu:
        stream: rhosp16.1-ha-ziu
        job-name: deploy-tf-rhosp16
        vars:
          TAG_SUFFIX: "-ubi7"
        depends-on:
          - deploy-platform-rhosp16.1-ha-ziu
      test-deployment-rhosp16.1-ha-ziu:
        stream: rhosp16.1-ha-ziu
        job-name: test-deployment
        timeout: 240
        vars:
          DEPLOYMENT_TEST_TAGS: ziu
          TF_DEPLOYMENT_TEST_IMAGE: $CONTAINER_REGISTRY_ORIGINAL/tf-deployment-test:$CONTRAIL_CONTAINER_TAG_ORIGINAL$TAG_SUFFIX
          TAG_SUFFIX: "-ubi8"
        depends-on:
          - package-ubi8
          - deploy-tf-rhosp16.1-ha-ziu
      test-sanity-rhosp16.1-ha-ziu:
        job-name: test-sanity
        stream: rhosp16.1-ha-ziu
        vars:
          TF_TEST_IMAGE: $CONTAINER_REGISTRY_ORIGINAL/contrail-test-test:$CONTRAIL_CONTAINER_TAG_ORIGINAL$TAG_SUFFIX
          TAG_SUFFIX: "-ubi8"
        depends-on:
          - test-deployment-rhosp16.1-ha-ziu
      collect-logs-and-cleanup-rhosp16.1-ha-ziu:
        job-name: collect-logs-and-cleanup
        stream: rhosp16.1-ha-ziu
        type: post-hook
        depends-on:
          - deploy-platform-rhosp16.1-ha-ziu
          - deploy-tf-rhosp16.1-ha-ziu
          - test-deployment-rhosp16.1-ha-ziu
          - test-sanity-rhosp16.1-ha-ziu
